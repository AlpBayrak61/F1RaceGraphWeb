<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>F1 Telemetry Analytics</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #e10600; /* F1 red */
      text-align: center;
    }
    form {
      background-color: #f8f8f8;
      padding: 20px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: inline-block;
      width: 180px;
      font-weight: bold;
    }
    select, button {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
      width: 250px;
    }
    button {
      background-color: #e10600;
      color: white;
      border: none;
      cursor: pointer;
      width: auto;
      padding: 10px 20px;
      margin-top: 15px;
    }
    button:hover {
      background-color: #c10500;
    }
    .error {
      color: #e10600;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .result {
      text-align: center;
    }
    .result img {
      max-width: 100%;
      border: 1px solid #ddd;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>Formula 1 Telemetry Analytics</h1>
  
  {% if error %}
  <div class="error">{{ error }}</div>
  {% endif %}
  
  <form method="POST" action="/">
    <div class="form-group">
      <label for="year">Year:</label>
      <select name="year" id="year">
        {% for yr in years %}
        <option value="{{ yr }}">{{ yr }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="form-group">
      <label for="grand_prix">Grand Prix Location:</label>
      <select name="grand_prix" id="grand_prix">
        {% if grand_prix_options %}
          {% for gp in grand_prix_options %}
            <option value="{{ gp }}">{{ gp }}</option>
          {% endfor %}
        {% else %}
            <option value="">Select Location</option>
        {% endif %}
      </select>
    </div>
    
    <div class="form-group">
      <label for="session">Session:</label>
      <select name="session" id="session">
        {% for sess in sessions %}
        <option value="{{ sess }}">{{ sess }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="form-group">
      <label for="driver1">Driver 1:</label>
      <select name="driver1" id="driver1">
        {% if driver_options %}
          {% for d in driver_options %}
            <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        {% else %}
          <option value="">Select Driver</option>
        {% endif %}
      </select>
    </div>
    
    <div class="form-group">
      <label for="driver2">Driver 2:</label>
      <select name="driver2" id="driver2">
        {% if driver_options %}
          {% for d in driver_options %}
            <option value="{{ d }}">{{ d }}</option>
          {% endfor %}
        {% else %}
          <option value="">Select Driver</option>
        {% endif %}
      </select>
    </div>
    
    <div class="form-group">
      <label for="analysis">Analysis Type:</label>
      <select name="analysis" id="analysis">
        {% for a in analysis_options %}
        <option value="{{ a }}">{{ a }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="form-group" id="lap-number-div" style="display: none;">
      <label for="lap_number">Lap Number:</label>
      <select name="lap_number" id="lap_number">
        {% if lap_options %}
          {% for lap in lap_options %}
          <option value="{{ lap }}">{{ lap }}</option>
          {% endfor %}
        {% else %}
          <option value="1">1</option>
        {% endif %}
      </select>
    </div>
    
    <button type="submit">Run Analysis</button>
  </form>
  
  {% if image_file %}
  <div class="result">
    <h2>Analysis Result</h2>
    <img src="{{ url_for('static', filename='plot/' + image_file) }}" alt="Plot">
  </div>
  {% endif %}
  
  <script>
    // Toggle lap number selection when 'Fastest Sectors' is chosen.
    document.getElementById('analysis').addEventListener('change', function() {
      const lapDiv = document.getElementById('lap-number-div');
      if (this.value === 'Fastest Sectors') {
        lapDiv.style.display = 'block';
      } else {
        lapDiv.style.display = 'none';
      }
    });
    
    // Check if 'Fastest Sectors' is selected on page load
    window.addEventListener('load', function() {
      const analysis = document.getElementById('analysis');
      if (analysis.value === 'Fastest Sectors') {
        document.getElementById('lap-number-div').style.display = 'block';
      }
    });
    
    // Update Grand Prix and Driver options when Year changes
    document.getElementById('year').addEventListener('change', function() {
      const year = this.value;
      if (year !== 'Select Year') {
        // Use fetch to get updated options
        fetch('/update_options', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `year=${encodeURIComponent(year)}`
        })
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            console.error(data.error);
            return;
          }
          
          // Update Grand Prix options
          const gpSelect = document.getElementById('grand_prix');
          gpSelect.innerHTML = '';
          data.grand_prix_options.forEach(gp => {
            const option = document.createElement('option');
            option.value = gp;
            option.textContent = gp;
            gpSelect.appendChild(option);
          });
          
          // Update Driver options
          const driver1Select = document.getElementById('driver1');
          const driver2Select = document.getElementById('driver2');
          
          driver1Select.innerHTML = '';
          driver2Select.innerHTML = '';
          
          data.driver_options.forEach(driver => {
            // Add to driver1
            const option1 = document.createElement('option');
            option1.value = driver;
            option1.textContent = driver;
            driver1Select.appendChild(option1);
            
            // Add to driver2
            const option2 = document.createElement('option');
            option2.value = driver;
            option2.textContent = driver;
            driver2Select.appendChild(option2);
          });
        })
        .catch(error => {
          console.error('Error updating options:', error);
        });
      }
    });
  </script>
</body>
</html>